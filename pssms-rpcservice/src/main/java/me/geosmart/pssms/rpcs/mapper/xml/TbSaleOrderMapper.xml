<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.geosmart.pssms.rpcs.mapper.TbSaleOrderMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="me.geosmart.pssms.rpcs.entity.TbSaleOrder">
        <id column="serialId" property="serialId" />
        <result column="order_type" property="orderType" />
        <result column="order_id" property="orderId" />
        <result column="order_date" property="orderDate" />
        <result column="customer_code" property="customerCode" />
        <result column="product_code" property="productCode" />
        <result column="number" property="number" />
        <result column="price" property="price" />
        <result column="amount" property="amount" />
        <result column="memo" property="memo" />
    </resultMap>

    <select id="selectSumSaleAmount" resultType="java.lang.Double">
        SELECT sum(amount) as sale_amount
        FROM tb_sale_order
        <where>
            amount is not null
            <if test="orderType != null">AND order_type = #{orderType}</if>
            <if test="orderDateBegin != null">AND order_date <![CDATA[ >= ]]> #{orderDateBegin}</if>
            <if test="orderDateEnd != null">AND order_date <![CDATA[ <= ]]> #{orderDateEnd}</if>
        </where>
    </select>

    <select id="groupAmountByProduct" resultType="java.util.HashMap">
        SELECT product_code,sum(amount) as sale_amount FROM tb_sale_order
        <where>
            amount is not null
            <if test="orderType != null">AND order_type = #{orderType}</if>
            <if test="orderType != null">AND order_type = #{orderType}</if>
            <if test="orderDateBegin != null">AND order_date <![CDATA[ >= ]]> #{orderDateBegin}</if>
            <if test="orderDateEnd != null">AND order_date <![CDATA[ <= ]]> #{orderDateEnd}</if>
        </where>
        GROUP BY product_code
        ORDER BY sale_amount desc
    </select>

    <select id="groupNumberByProduct" resultType="java.util.HashMap">
        SELECT product_code,order_type,sum(number) as sale_number FROM tb_sale_order
        <where>
            number is not null
            <if test="orderType != null">AND order_type = #{orderType}</if>
            <if test="orderDateBegin != null">AND order_date <![CDATA[ >= ]]> #{orderDateBegin}</if>
            <if test="orderDateEnd != null">AND order_date <![CDATA[ <= ]]> #{orderDateEnd}</if>
        </where>
        GROUP BY product_code,order_type  ORDER BY product_code,order_type desc,sale_number  desc
    </select>

</mapper>
